<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Hairstyle Try-On</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .main-content {
            padding: 30px;
        }

        .camera-section {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            aspect-ratio: 4/3;
            max-height: 500px;
        }

        #video, #canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }

        .overlay-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .hairstyles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .hairstyle-option {
            position: relative;
            border: 3px solid transparent;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .hairstyle-option:hover {
            transform: scale(1.05);
            border-color: #667eea;
        }

        .hairstyle-option.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .hairstyle-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .hairstyle-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        .status {
            text-align: center;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            color: #667eea;
        }

        .slider-control {
            margin-bottom: 20px;
        }

        .slider-control label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .main-content {
                padding: 20px;
            }

            .hairstyles-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ Virtual Hairstyle Try-On</h1>
            <p>Try different hairstyles with AR technology</p>
        </div>

        <div class="main-content">
            <div class="status" id="status">Click "Start Camera" to begin</div>

            <div class="camera-section">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <canvas id="overlayCanvas" class="overlay-canvas"></canvas>
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="startBtn">
                    ðŸ“· Start Camera
                </button>
                <button class="btn btn-secondary" id="captureBtn" style="display:none;">
                    ðŸ“¸ Capture Photo
                </button>
                <button class="btn btn-secondary" id="switchBtn" style="display:none;">
                    ðŸ”„ Switch Camera
                </button>
                <button class="btn btn-secondary" id="downloadBtn" style="display:none;">
                    ðŸ’¾ Download
                </button>
            </div>

            <div class="slider-control">
                <label for="opacitySlider">Hairstyle Opacity: <span id="opacityValue">80%</span></label>
                <input type="range" id="opacitySlider" min="0" max="100" value="80">
            </div>

            <h3 style="margin-bottom: 15px; color: #333;">Choose a Hairstyle:</h3>
            <div class="hairstyles-grid" id="hairstylesGrid"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading face detection...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const overlayCanvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');
        const overlayCtx = overlayCanvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const captureBtn = document.getElementById('captureBtn');
        const switchBtn = document.getElementById('switchBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const status = document.getElementById('status');
        const opacitySlider = document.getElementById('opacitySlider');
        const opacityValue = document.getElementById('opacityValue');
        const loading = document.getElementById('loading');

        let stream = null;
        let facingMode = 'user';
        let detector = null;
        let selectedHairstyle = null;
        let opacity = 0.8;
        let animationId = null;

        const hairstyles = [
            { id: 1, name: 'Classic', icon: 'ðŸ‘¨', color: '#2c3e50' },
            { id: 2, name: 'Pompadour', icon: 'ðŸ’‡â€â™‚ï¸', color: '#34495e' },
            { id: 3, name: 'Undercut', icon: 'âœ‚ï¸', color: '#7f8c8d' },
            { id: 4, name: 'Quiff', icon: 'ðŸŽ©', color: '#95a5a6' },
            { id: 5, name: 'Slick Back', icon: 'ðŸ‘”', color: '#1a1a1a' },
            { id: 6, name: 'Fade', icon: 'âš¡', color: '#2c3e50' },
            { id: 7, name: 'Mohawk', icon: 'ðŸ¤˜', color: '#c0392b' },
            { id: 8, name: 'Long Hair', icon: 'ðŸ¦', color: '#8b4513' },
            { id: 9, name: 'Curly', icon: 'ðŸŒ€', color: '#654321' }
        ];

        // Initialize hairstyles grid
        const hairstylesGrid = document.getElementById('hairstylesGrid');
        hairstyles.forEach(style => {
            const div = document.createElement('div');
            div.className = 'hairstyle-option';
            div.innerHTML = `
                <div class="hairstyle-icon">${style.icon}</div>
                <div class="hairstyle-name">${style.name}</div>
            `;
            div.addEventListener('click', () => selectHairstyle(style, div));
            hairstylesGrid.appendChild(div);
        });

        function selectHairstyle(style, element) {
            document.querySelectorAll('.hairstyle-option').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');
            selectedHairstyle = style;
            status.textContent = `Selected: ${style.name}`;
        }

        opacitySlider.addEventListener('input', (e) => {
            opacity = e.target.value / 100;
            opacityValue.textContent = e.target.value + '%';
        });

        async function initFaceDetection() {
            loading.style.display = 'block';
            try {
                const model = await faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;
                const detectorConfig = {
                    runtime: 'tfjs',
                    refineLandmarks: true
                };
                detector = await faceLandmarksDetection.createDetector(model, detectorConfig);
                loading.style.display = 'none';
                status.textContent = 'Face detection ready!';
            } catch (error) {
                console.error('Error loading face detection:', error);
                loading.style.display = 'none';
                status.textContent = 'Face detection unavailable - manual mode';
            }
        }

        async function startCamera() {
            try {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });

                video.srcObject = stream;
                video.style.display = 'block';
                canvas.style.display = 'none';

                video.addEventListener('loadedmetadata', () => {
                    overlayCanvas.width = video.videoWidth;
                    overlayCanvas.height = video.videoHeight;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                });

                startBtn.style.display = 'none';
                captureBtn.style.display = 'inline-flex';
                switchBtn.style.display = 'inline-flex';
                status.textContent = 'Camera active - Select a hairstyle and pose!';

                if (detector) {
                    detectFaces();
                }

            } catch (error) {
                console.error('Error accessing camera:', error);
                status.textContent = 'Camera access denied or unavailable';
            }
        }

        async function detectFaces() {
            if (!detector || !video.videoWidth) {
                animationId = requestAnimationFrame(detectFaces);
                return;
            }

            const faces = await detector.estimateFaces(video);
            
            overlayCtx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);

            if (faces.length > 0 && selectedHairstyle) {
                const face = faces,[object Object],;
                drawHairstyle(face);
            }

            animationId = requestAnimationFrame(detectFaces);
        }

        function drawHairstyle(face) {
            const keypoints = face.keypoints;
            
            // Get forehead and head boundaries
            const leftTemple = keypoints,[object Object],;
            const rightTemple = keypoints,[object Object],;
            const noseTip = keypoints,[object Object],;
            const topHead = keypoints,[object Object],;

            const headWidth = Math.abs(rightTemple.x - leftTemple.x) * 1.4;
            const headHeight = Math.abs(topHead.y - noseTip.y) * 1.5;

            const centerX = (leftTemple.x + rightTemple.x) / 2;
            const topY = topHead.y - headHeight * 0.3;

            overlayCtx.save();
            overlayCtx.globalAlpha = opacity;

            // Draw hairstyle based on type
            switch(selectedHairstyle.id) {
                case 1: // Classic
                    drawClassicHair(centerX, topY, headWidth, headHeight);
                    break;
                case 2: // Pompadour
                    drawPompadour(centerX, topY, headWidth, headHeight);
                    break;
                case 3: // Undercut
                    drawUndercut(centerX, topY, headWidth, headHeight);
                    break;
                case 4: // Quiff
                    drawQuiff(centerX, topY, headWidth, headHeight);
                    break;
                case 5: // Slick Back
                    drawSlickBack(centerX, topY, headWidth, headHeight);
                    break;
                case 6: // Fade
                    drawFade(centerX, topY, headWidth, headHeight);
                    break;
                case 7: // Mohawk
                    drawMohawk(centerX, topY, headWidth, headHeight);
                    break;
                case 8: // Long Hair
                    drawLongHair(centerX, topY, headWidth, headHeight);
                    break;
                case 9: // Curly
                    drawCurlyHair(centerX, topY, headWidth, headHeight);
                    break;
            }

            overlayCtx.restore();
        }

        function drawClassicHair(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y, w/2, h/2.5, 0, 0, Math.PI * 2);
            overlayCtx.fill();
        }

        function drawPompadour(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y - h/4, w/2, h/2, 0, 0, Math.PI * 2);
            overlayCtx.fill();
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y + h/6, w/2.2, h/3, 0, 0, Math.PI, true);
            overlayCtx.fill();
        }

        function drawUndercut(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y, w/2.5, h/3, 0, 0, Math.PI * 2);
            overlayCtx.fill();
        }

        function drawQuiff(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.moveTo(x - w/2, y + h/3);
            overlayCtx.quadraticCurveTo(x - w/3, y - h/2, x, y - h/3);
            overlayCtx.quadraticCurveTo(x + w/3, y - h/2, x + w/2, y + h/3);
            overlayCtx.quadraticCurveTo(x, y + h/2, x - w/2, y + h/3);
            overlayCtx.fill();
        }

        function drawSlickBack(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y + h/6, w/2, h/2.5, 0, 0, Math.PI * 2);
            overlayCtx.fill();
        }

        function drawFade(x, y, w, h) {
            const gradient = overlayCtx.createLinearGradient(x, y, x, y + h);
            gradient.addColorStop(0, selectedHairstyle.color);
            gradient.addColorStop(1, 'rgba(44, 62, 80, 0.3)');
            overlayCtx.fillStyle = gradient;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y, w/2, h/2.5, 0, 0, Math.PI * 2);
            overlayCtx.fill();
        }

        function drawMohawk(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.moveTo(x, y - h/2);
            overlayCtx.lineTo(x - w/6, y + h/3);
            overlayCtx.lineTo(x + w/6, y + h/3);
            overlayCtx.closePath();
            overlayCtx.fill();
        }

        function drawLongHair(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            overlayCtx.beginPath();
            overlayCtx.ellipse(x, y, w/2, h/2, 0, 0, Math.PI * 2);
            overlayCtx.fill();
            overlayCtx.beginPath();
            overlayCtx.ellipse(x - w/3, y + h, w/4, h/1.5, 0, 0, Math.PI * 2);
            overlayCtx.fill();
            overlayCtx.beginPath();
            overlayCtx.ellipse(x + w/3, y + h, w/4, h/1.5, 0, 0, Math.PI * 2);
            overlayCtx.fill();
        }

        function drawCurlyHair(x, y, w, h) {
            overlayCtx.fillStyle = selectedHairstyle.color;
            const curlCount = 12;
            for (let i = 0; i < curlCount; i++) {
                const angle = (Math.PI * 2 * i) / curlCount;
                const curlX = x + Math.cos(angle) * (w/3);
                const curlY = y + Math.sin(angle) * (h/3);
                overlayCtx.beginPath();
                overlayCtx.arc(curlX, curlY, w/12, 0, Math.PI * 2);
                overlayCtx.fill();
            }
        }

        function capturePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            // Draw overlay on captured image
            ctx.drawImage(overlayCanvas, 0, 0);

            canvas.style.display = 'block';
            video.style.display = 'none';
            overlayCanvas.style.display = 'none';

            downloadBtn.style.display = 'inline-flex';
            captureBtn.textContent = 'ðŸ”„ Retake';
            captureBtn.onclick = retake;

            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function retake() {
            canvas.style.display = 'none';
            video.style.display = 'block';
            overlayCanvas.style.display = 'block';
            downloadBtn.style.display = 'none';
            captureBtn.textContent = 'ðŸ“¸ Capture Photo';
            captureBtn.onclick = capturePhoto;

            if (detector) {
                detectFaces();
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'hairstyle-tryOn.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        async function switchCamera() {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            await startCamera();
        }

        startBtn.addEventListener('click', async () => {
            await initFaceDetection();
            await startCamera();
        });
        captureBtn.addEventListener('click', capturePhoto);
        switchBtn.addEventListener('click', switchCamera);
        downloadBtn.addEventListener('click', downloadImage);
    </script>
</body>
</html>
